function load_recipe(url,action){fetch(url).then(response=>{if(!response.ok){throw new Error(`HTTP error, status = ${response.status}`)}return response.json()}).then(json=>action(json)).catch(error=>console.log(error))}function download(data,filename,mimetype){let file=new Blob([data],{type:mimetype});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(file,filename);else{let a=document.createElement("a");let url=URL.createObjectURL(file);a.href=url;a.download=filename;document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);window.URL.revokeObjectURL(url)},0)}}function setup_command_download(dom_element){let link_for_download=new URL(dom_element.dataset.href,document.baseURI).href;dom_element.onclick=()=>{load_recipe(link_for_download,recipe=>{let title=recipe["title"];if(title===undefined||title==""){title="Рецепт"}let recipe_string=JSON.stringify(recipe,null,2);download(recipe_string,title+".json","application/json")})}}function main(){let download_elements=document.getElementsByClassName("command-download");for(let i in download_elements){let element=download_elements[i];setup_command_download(element)}}document.addEventListener("DOMContentLoaded",main);
